[gd_scene load_steps=31 format=3 uid="uid://udnpbm1rw07e"]

[ext_resource type="Script" path="res://Scripts/Player Units/PlayerSoldier.gd" id="1_ad4fn"]
[ext_resource type="Material" uid="uid://ctk2i5tsi8mmu" path="res://Material/unit.tres" id="2_6rdr8"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_b4w0m"]
animation = &"Swing"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ywqu4"]
animation = &"idle"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_0sf71"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_2nr56"]
advance_mode = 2
advance_condition = &"is_attacking"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_picgr"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_eskig"]
states/Swing/node = SubResource("AnimationNodeAnimation_b4w0m")
states/Swing/position = Vector2(461, 18)
states/idle/node = SubResource("AnimationNodeAnimation_ywqu4")
states/idle/position = Vector2(461, 100)
transitions = ["Start", "idle", SubResource("AnimationNodeStateMachineTransition_0sf71"), "idle", "Swing", SubResource("AnimationNodeStateMachineTransition_2nr56"), "Swing", "idle", SubResource("AnimationNodeStateMachineTransition_picgr")]
graph_offset = Vector2(-177, -36)

[sub_resource type="Animation" id="Animation_7pk08"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../Camera3D/Node3D/AttackArea/CSGBox3D2:rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(-1.26293, 1.56435, 2.98789)]
}

[sub_resource type="Animation" id="Animation_e12gw"]
resource_name = "Swing"
step = 0.0416667
tracks/0/type = "position_3d"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../Camera3D/Node3D/AttackArea/CSGBox3D2")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = PackedFloat32Array(0, 1, 0.096, 0.006, -0.205, 0.1668, 1, 0.1, 0.006, -0.205, 0.2919, 1, -0.08, -0.02, -0.155, 0.8757, 1, 0.096, 0.006, -0.205)
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../Camera3D/Node3D/AttackArea/CSGBox3D2:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1668, 0.2919, 0.8757),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [Vector3(-1.26293, 1.56435, 2.98789), Vector3(-1.26293, 1.56435, 2.98789), Vector3(-0.0314619, 3.13326, 2.9869), Vector3(-1.26293, 1.56435, 2.98789)]
}

[sub_resource type="Animation" id="Animation_jpc6a"]

[sub_resource type="Animation" id="Animation_04hpc"]
resource_name = "idle"
tracks/0/type = "position_3d"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("../Camera3D/Node3D/AttackArea/CSGBox3D2")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = PackedFloat32Array(0.1, 1, 0.096, 0.006, -0.205)
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../Camera3D/Node3D/AttackArea/CSGBox3D2:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.1),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(-1.26293, 1.56435, 2.98789)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_wq5el"]
_data = {
"RESET": SubResource("Animation_7pk08"),
"Swing": SubResource("Animation_e12gw"),
"Swing2": SubResource("Animation_jpc6a"),
"idle": SubResource("Animation_04hpc")
}

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_du5pn"]
diffuse_mode = 3
albedo_color = Color(0.517647, 0.517647, 0.517647, 1)
metallic = 1.0
metallic_specular = 1.0
metallic_texture_channel = 4
roughness = 0.33

[sub_resource type="BoxShape3D" id="BoxShape3D_aj8wd"]
size = Vector3(0.306267, 0.169936, 0.210428)

[sub_resource type="SphereShape3D" id="SphereShape3D_if0f0"]
radius = 1.0

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_u0nfh"]
transparency = 1
shading_mode = 0
albedo_color = Color(0, 0.47451, 0.796078, 1)

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_reaox"]
particle_flag_align_y = true
direction = Vector3(0, 1, 0)
spread = 10.0
initial_velocity_min = 2.0
initial_velocity_max = 4.0
scale_min = 0.1
scale_max = 0.2

[sub_resource type="BoxMesh" id="BoxMesh_sldxj"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_rir3c"]
transparency = 1
shading_mode = 0
albedo_color = Color(0, 0.603922, 0.831373, 1)

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_niqgo"]
particle_flag_align_y = true
direction = Vector3(0, 1, 0)
spread = 10.0
initial_velocity_min = 2.5
initial_velocity_max = 5.0
scale_min = 0.03
scale_max = 0.05

[sub_resource type="BoxMesh" id="BoxMesh_axt7x"]

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_i3siv"]
border_width_left = 2
border_width_top = 2
border_width_right = 2
border_width_bottom = 2
border_color = Color(1, 1, 1, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_abxbp"]
bg_color = Color(1, 0.435294, 0.105882, 1)

[sub_resource type="ViewportTexture" id="ViewportTexture_cuue6"]
viewport_path = NodePath("SubViewport")

[sub_resource type="LabelSettings" id="LabelSettings_exjvt"]
font_size = 40
font_color = Color(1, 1, 1, 0.333333)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_dtadh"]
bg_color = Color(0, 0, 0, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_o0n6p"]
bg_color = Color(0.847059, 0.509804, 0.0235294, 1)
border_width_left = 1
border_width_top = 1
border_width_right = 1
border_width_bottom = 1
border_color = Color(1, 1, 1, 1)

[sub_resource type="LabelSettings" id="LabelSettings_0af75"]
font_size = 31

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_3x3pl"]
radius = 0.121197
height = 0.371705

[node name="Soldier" type="CharacterBody3D" node_paths=PackedStringArray("animTree", "visionSphere", "body", "attackRange", "camera", "attackCooldown", "hitDelay", "deathParticle", "hitParticle", "Weapon", "healthBar", "PossessedUI") groups=["Player units"]]
collision_layer = 18
collision_mask = 19
axis_lock_angular_x = true
axis_lock_angular_z = true
script = ExtResource("1_ad4fn")
animTree = NodePath("AnimationTree")
team = 1
speed = 0.5
visionSphere = NodePath("Area3D")
body = NodePath("CSGBox3D")
attackRange = NodePath("Camera3D/Node3D/AttackArea")
camera = NodePath("Camera3D")
attackCooldown = NodePath("AttackTimer")
hitDelay = NodePath("hitDelay")
attackDelay = 0.24
deathParticle = NodePath("GPUParticles3D")
hitParticle = NodePath("HitParticle")
Weapon = NodePath("Camera3D/Node3D")
healthBar = NodePath("SubViewport/Healthbar")
PossessedUI = NodePath("CanvasLayer")
unitType = "PlayerSoldier"

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("AnimationNodeStateMachine_eskig")
anim_player = NodePath("../AnimationPlayer")
active = true
parameters/conditions/is_attacking = false

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
root_node = NodePath("../AnimationTree")
libraries = {
"": SubResource("AnimationLibrary_wq5el")
}

[node name="CSGBox3D" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.00351304, 0, 0)
material_override = ExtResource("2_6rdr8")
size = Vector3(0.224632, 0.16093, 0.305133)

[node name="CSGBox3D3" type="CSGBox3D" parent="."]
transform = Transform3D(-0.152264, 0.940742, 0.303019, 0.046392, -0.299452, 0.952983, 0.98725, 0.159163, 0.00195298, 0, 0, 0)
visible = false
size = Vector3(0.0233708, 0.002, 0.155256)

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.000278786, 0.00747511, -0.0938173)

[node name="Node3D" type="Node3D" parent="Camera3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.000278786, -0.00747511, 0.0991969)

[node name="AttackArea" type="Area3D" parent="Camera3D/Node3D"]
collision_layer = 18
collision_mask = 23

[node name="CSGBox3D2" type="CSGBox3D" parent="Camera3D/Node3D/AttackArea"]
transform = Transform3D(-0.152267, 0.940737, 0.30302, 0.0463927, -0.299452, 0.952983, 0.987249, 0.159165, 0.00195339, 0.096, 0.006, -0.205)
sorting_offset = 1.0
sorting_use_aabb_center = false
material_override = SubResource("StandardMaterial3D_du5pn")
cast_shadow = 0
size = Vector3(0.0233708, 0.002, 0.155256)

[node name="CollisionShape3D" type="CollisionShape3D" parent="Camera3D/Node3D/AttackArea"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.000215024, 0.018179, -0.261976)
shape = SubResource("BoxShape3D_aj8wd")

[node name="Area3D" type="Area3D" parent="."]
collision_layer = 31
collision_mask = 31

[node name="CollisionShape3D" type="CollisionShape3D" parent="Area3D"]
shape = SubResource("SphereShape3D_if0f0")

[node name="AttackTimer" type="Timer" parent="."]
one_shot = true
autostart = true

[node name="hitDelay" type="Timer" parent="."]
wait_time = 0.24
one_shot = true
autostart = true

[node name="GPUParticles3D" type="GPUParticles3D" parent="."]
material_override = SubResource("StandardMaterial3D_u0nfh")
emitting = false
amount = 10
one_shot = true
explosiveness = 1.0
visibility_aabb = AABB(-0.456979, -1.11102, -0.539887, 0.913958, 2.00134, 1.07977)
process_material = SubResource("ParticleProcessMaterial_reaox")
draw_pass_1 = SubResource("BoxMesh_sldxj")

[node name="HitParticle" type="GPUParticles3D" parent="."]
material_override = SubResource("StandardMaterial3D_rir3c")
emitting = false
amount = 10
one_shot = true
explosiveness = 1.0
process_material = SubResource("ParticleProcessMaterial_niqgo")
draw_pass_1 = SubResource("BoxMesh_axt7x")

[node name="SubViewport" type="SubViewport" parent="."]
disable_3d = true
transparent_bg = true

[node name="Healthbar" type="ProgressBar" parent="SubViewport"]
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -275.0
offset_top = -13.5
offset_right = 275.0
offset_bottom = 13.5
grow_horizontal = 2
grow_vertical = 2
size_flags_vertical = 4
theme_override_styles/background = SubResource("StyleBoxFlat_i3siv")
theme_override_styles/fill = SubResource("StyleBoxFlat_abxbp")
value = 100.0
show_percentage = false

[node name="Sprite3D" type="Sprite3D" parent="."]
transform = Transform3D(0.05, 0, 0, 0, 0.05, 0, 0, 0, 0.05, -0.00203092, 0.113938, -0.0108735)
billboard = 1
texture = SubResource("ViewportTexture_cuue6")

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="Label" type="Label" parent="CanvasLayer"]
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -11.5
offset_top = -29.0
offset_right = 11.5
offset_bottom = 29.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 4
text = "+"
label_settings = SubResource("LabelSettings_exjvt")
metadata/_edit_use_anchors_ = true

[node name="ProgressBar" type="ProgressBar" parent="CanvasLayer"]
anchors_preset = -1
anchor_left = 0.139
anchor_top = 0.019
anchor_right = 0.139
anchor_bottom = 0.019
offset_left = -0.128021
offset_top = -0.312001
offset_right = 299.872
offset_bottom = 38.688
theme_override_styles/background = SubResource("StyleBoxFlat_dtadh")
theme_override_styles/fill = SubResource("StyleBoxFlat_o0n6p")
value = 100.0
show_percentage = false
metadata/_edit_use_anchors_ = true

[node name="Label2" type="Label" parent="CanvasLayer"]
anchors_preset = -1
anchor_left = 0.032
anchor_top = 0.009
anchor_right = 0.032
anchor_bottom = 0.009
offset_left = 0.135998
offset_top = 0.168
offset_right = 121.136
offset_bottom = 47.168
text = "Health:"
label_settings = SubResource("LabelSettings_0af75")
metadata/_edit_use_anchors_ = true

[node name="CollisionShape3D2" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, -0.000673711, 0.00039959, 0.018458)
shape = SubResource("CapsuleShape3D_3x3pl")

[node name="Rays" type="Node3D" parent="."]

[node name="RayCast3D" type="RayCast3D" parent="Rays"]
transform = Transform3D(0.5, 0, 0, 0, -2.18557e-08, 0.5, 0, -0.5, -2.18557e-08, 0, 0, 0)
collision_mask = 18

[node name="RayCast3D2" type="RayCast3D" parent="Rays"]
transform = Transform3D(0.5, 0, 0, 0, -2.18557e-08, 0.5, 0, -0.5, -2.18557e-08, 0, 0, 0)
target_position = Vector3(0, 1, 0)
collision_mask = 18

[node name="RayCast3D3" type="RayCast3D" parent="Rays"]
transform = Transform3D(0.5, 0, 0, 0, -2.18557e-08, 0.5, 0, -0.5, -2.18557e-08, 0, 0, 0)
target_position = Vector3(0.7, -0.7, 0)
collision_mask = 18

[node name="RayCast3D4" type="RayCast3D" parent="Rays"]
transform = Transform3D(0.5, 0, 0, 0, -2.18557e-08, 0.5, 0, -0.5, -2.18557e-08, 0, 0, 0)
target_position = Vector3(1, 0, 0)
collision_mask = 18

[node name="RayCast3D5" type="RayCast3D" parent="Rays"]
transform = Transform3D(0.5, 0, 0, 0, -2.18557e-08, 0.5, 0, -0.5, -2.18557e-08, 0, 0, 0)
target_position = Vector3(0.7, 0.7, 0)
collision_mask = 18

[node name="RayCast3D6" type="RayCast3D" parent="Rays"]
transform = Transform3D(0.5, 0, 0, 0, -2.18557e-08, 0.5, 0, -0.5, -2.18557e-08, 0, 0, 0)
target_position = Vector3(-0.7, -0.7, 0)
collision_mask = 18

[node name="RayCast3D7" type="RayCast3D" parent="Rays"]
transform = Transform3D(0.5, -0.000327879, -1.4332e-11, 0, -2.18557e-08, 0.5, -0.000327879, -0.5, -2.18557e-08, 0, 0, 0)
target_position = Vector3(-0.7, 0.7, 0)
collision_mask = 18

[node name="RayCast3D8" type="RayCast3D" parent="Rays"]
transform = Transform3D(0.5, 0, 0, 0, -2.18557e-08, 0.5, 0, -0.5, -2.18557e-08, 0, 0, 0)
target_position = Vector3(-1, 0, 0)
collision_mask = 18
